<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Autoescuela</title>
  <style>
    #marcador {
      margin: 30px;
      height: 30%;
    }
    #questionari button {
      display: block;
      margin: auto;
      width: 80%;
    }
    #crudPanel {
      display: none;
      max-width: 700px;
      margin: 30px auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
  </style>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="./js/inicio.js" type="module"></script>
</head>
<body class="bg-light">

  <div id="inicio"></div>

  <div class="container py-3">
    <div class="row g-3">
      <div id="questionari" class="col-md-8 card shadow-sm p-3 fs-6"></div>
      <div id="marcador" class="col-md-3 alert alert-secondary text-center fs-6 py-2 px-3"></div>
    </div>
  </div>


  <div class="text-center mt-4">
    <button id="btnPanelAdmin" class="btn btn-warning">Panel Administraci√≥n</button>
  </div>

  <div id="crudPanel">
    <div class="mb-3 text-center">
      <button id="btnCrearPregunta" class="btn btn-success me-2">Crear Pregunta</button>
      <button id="btnEditarPregunta" class="btn btn-primary me-2">Editar Pregunta</button>
      <button id="btnBorrarPregunta" class="btn btn-danger">Borrar Pregunta</button>
    </div>

    <div id="crearForm" style="display:none;">
      <h5>Crear Pregunta</h5>
      <form id="formCrear">
        <input class="form-control mb-2" type="text" name="Pregunta" placeholder="Pregunta" required>
        <input class="form-control mb-2" type="text" name="Respuesta1" placeholder="Respuesta 1" required>
        <input class="form-control mb-2" type="text" name="Respuesta2" placeholder="Respuesta 2" required>
        <input class="form-control mb-2" type="text" name="Respuesta3" placeholder="Respuesta 3" required>
        <select class="form-control mb-2" name="respostaCorrecta" required>
          <option value="">Selecciona la respuesta correcta</option>
          <option value="Respuesta1">Respuesta 1</option>
          <option value="Respuesta2">Respuesta 2</option>
          <option value="Respuesta3">Respuesta 3</option>
        </select>
        <input class="form-control mb-2" type="text" name="imatge" placeholder="URL de la imagen">
        <input class="form-control mb-2" type="number" name="idRespuesta" placeholder="ID de respuesta" required>
        <button type="submit" class="btn btn-success">Crear</button>
      </form>
    </div>

    <div id="editarForm" style="display:none;">
      <h5>Editar Pregunta</h5>
      <select id="selectEditar" class="form-select mb-2"></select>
      <form id="formEditar">
        <input class="form-control mb-2" type="text" name="Pregunta" placeholder="Pregunta" required>
        <input class="form-control mb-2" type="text" name="Respuesta1" placeholder="Respuesta 1" required>
        <input class="form-control mb-2" type="text" name="Respuesta2" placeholder="Respuesta 2" required>
        <input class="form-control mb-2" type="text" name="Respuesta3" placeholder="Respuesta 3" required>
        <select class="form-control mb-2" name="respostaCorrecta" required>
          <option value="">Selecciona la respuesta correcta</option>
          <option value="Respuesta1">Respuesta 1</option>
          <option value="Respuesta2">Respuesta 2</option>
          <option value="Respuesta3">Respuesta 3</option>
        </select>
        <input class="form-control mb-2" type="text" name="imatge" placeholder="URL de la imagen">
        <input type="hidden" name="idPregunta">
        <input class="form-control mb-2" type="number" name="idRespuesta" placeholder="ID de respuesta" required>
        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
      </form>
    </div>

    <div id="borrarForm" style="display:none;">
      <h5>Borrar Pregunta</h5>
      <select id="selectBorrar" class="form-select mb-2"></select>
      <button id="btnConfirmarBorrar" class="btn btn-danger">Borrar</button>
    </div>
  </div>

  <script>

    const btnPanel = document.getElementById("btnPanelAdmin");
    const crudPanel = document.getElementById("crudPanel");
    btnPanel.addEventListener("click", () => {
      crudPanel.style.display = crudPanel.style.display === "none" ? "block" : "none";
    });


    const btnCrear = document.getElementById("btnCrearPregunta");
    const btnEditar = document.getElementById("btnEditarPregunta");
    const btnBorrar = document.getElementById("btnBorrarPregunta");
    const crearForm = document.getElementById("crearForm");
    const editarForm = document.getElementById("editarForm");
    const borrarForm = document.getElementById("borrarForm");

    btnCrear.addEventListener("click", () => {
      crearForm.style.display = "block";
      editarForm.style.display = "none";
      borrarForm.style.display = "none";
    });
    btnEditar.addEventListener("click", () => {
      crearForm.style.display = "none";
      editarForm.style.display = "block";
      borrarForm.style.display = "none";
      cargarPreguntasSelect("selectEditar");
    });
    btnBorrar.addEventListener("click", () => {
      crearForm.style.display = "none";
      editarForm.style.display = "none";
      borrarForm.style.display = "block";
      cargarPreguntasSelect("selectBorrar");
    });


    function cargarPreguntasSelect(selectId) {
      fetch("php/crud.php?action=read")
        .then(res => res.json())
        .then(data => {
          const select = document.getElementById(selectId);
          select.innerHTML = "";
          data.forEach(p => {
            const option = document.createElement("option");
            option.value = p.idPregunta;
            option.textContent = `${p.idPregunta} - ${p.Pregunta}`;
            select.appendChild(option);
          });
        });
    }
  </script>
</body>
</html>
